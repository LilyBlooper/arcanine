## guide lines

### 如何衡量架构
* 优点
* 缺点
* 解决什么问题

### 理想的软件开发
* 过程
	* 敏捷
	* 持续交付
	* 自动化
* 组织
	* 规模小
	* 自主性
	* 小组化

### 微服务架构特点

架构上：
* 优点：
	* 语言无关性
	* 独立进程通讯
	* 高度解耦
	* 任务边界固定
	* 按需扩展
* 缺点
	* 设计分布式系统复杂度
	* 集成复杂度
	* 部署系统复杂度 - DevOps
	* 数据一致性
	* 性能监控

### 应用架构演进
1. 传统垂直应用架构
LAMP / MVC
问题：
	开发维护成本高、团队写作效率低、可靠性差、维护定制困难

2. RPC架构
暴露服务、远程代理对象、通信、序列化

有哪些？
Facebook 开发开源的 Apache Thrift
Hadoop子项目 Avro-RPC
Hessian
Google的gRPC

问题：
缺少 服务治理

3. SOA架构
一般原则：
* 服务可复用
* 服务共享一个标准契约
* 服务送耦合
* 服务是底层逻辑的抽象
* 服务可组合、可编排
* 服务是自治的
* 服务是无状态的
* 服务是可被自动发现的

因此，我们需要引入
服务治理：
* 服务定义
* 服务生命周期管理
* 服务版本治理
* 服务注册中心
* 服务监控
* 运行期服务质量保障
* 快速的故障定界定位手段
* 服务安全

4. 微服务架构 MSA
主要特征：
* 原子服务
* 高密度部署
* 敏捷交付
* 微自治

5. 总结
* MVC结构：业务规模小，所有功能部署在同一个进程里，双机或者前置负载均衡；此时，分离前后端的MVC是关键
* RPC架构：垂直应用变多的时候，抽取核心和公共服务；此时，提高复用和拆分的RPC是关键
* SOA架构：服务越来也多，提升服务质量的SOA是关键
* 微服务架构： 敏捷开发、持续交付、DevOps

###分布式服务框架
开源： dubbo , dubbox , pigeon
thrift 不等于 分布式服务框架

#### 分布式服务框架设计

Table 1 - Features

Feature | Function | Description
------------ | ------------- | -------------
服务订阅发布 | 配置化发布和引用服务 | 支持通过XML配置的方式发布和导入服务，降低对业务代码的侵入
~           | 服务自动发现机制     | 支持服务实时自动发现，由注册中心推送服务地址，消费者不需要配置服务提供者地址，服务地址透明化
~           | 服务在线注册和去注册 | 支持运行态注册新服务，也支持运行态取消某个服务的注册
服务路由     | 默认提供随机路由、轮询、基于权重的路由策略 | 默认提供常见的路由策略，避免重新造轮子
~           | 粘滞连接             | 总是向同一个提供方发请求，除非它挂掉，否则不切换
~           | 路由定制             | 支持用户自定义路由策略，方便扩展
集群容错     | Failover             | 失败自动切换：当出现失败时-重试其他服务器，**通常用于读操作；也可用于幂等写操作**
~           | Failback			    | 失败自动恢复：后台记录失败请求，定时重发，**通常用于消息通知操作**
~           | Failfast             | 快速失败，只发起一次调用，失败立即报错，**通常用于非幂等性操作**
服务调用     | 同步调用             | 消费者发起服务调用后，同步阻塞等待服务端响应
~           | 异步调用             | 消费者发起服务调用后，不阻塞立即返回，由服务端返回应答后异步通知消费者
~           | 并行调用             | 消费者同时对多个服务提供者批量发起服务调用请求，批量发起请求后，集中等待应答
多协议       | 私有协议             | 支持二进制等私有协议，支持私有协议定制和扩展
~           | 公有协议             | 提供 Web Service等公有协议，用于外部服务对接
序列化方式   | 二进制类序列化       | 支持 Thrift，Protocol buffer等二进制协议，提升序列化性能
~           | 文本类序列化         | 支持 JSON，XML等文本类型的序列化方式，提升通用性和可读性
统一配置     | 本地静态配置         | 安装部署修改一次，运行态不修改的配置，可以存放到本地配置文件中
~           | 基于配置中心的动态配置 | 运行态需要调整的参数，统一放到配置中心（服务注册中心），修改之后统一下发，实时生效
	
			 		 
			 		 
Table 2 - Performance

Feature | Description
------------ | ------------- 
高性能 | 在同等资源占用情况下，单服务提供者的TPS要尽量高
低时延 | 在同等资源占用情况下，服务调用时延要尽量低
性能线性增长 | 扩展服务提供者，性能要能够线性增长

Table 3 - Durance

Feature | Function | Description
------------ | ------------- | -------------
服务注册中心 | 服务健康状态检测 | 注册中心通过心跳检测服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者
~             | 故障切换         | 注册中心对等集群，任意一台宕掉后，将自动切换到另一台
~			 | 高可用           | 注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通信
消除单点故障 | 服务无状态       | 服务提供者无状态，任意一台宕掉后，不影响使用
~           | 服务集群容错     | 只要集群中有一台机器的服务提供者可用，业务就不会中断
链路健壮性   | 心跳检测         | 链路空闲时没有业务消息，通过定时心跳检测链路是否可用
~           | 断连重连机制     | 链路断连之后，根据客户端配置的重连策略定时重连，重连成功之前消息不会路由到短连的服务提供者上

Table 4 - Governance

Feature | Function | Description
------------ | ------------- | -------------
服务运行态管控 | 服务路由 | 业务高峰期，通过动态修改路由策略实现导流
~ | 服务限流       | 资源成为瓶颈时，服务端和消费者的动态流控
~ | 服务迁入迁出   | 实现资源的动态分配
~			   | 服务降级       | 服务提供者故障时或者业务高峰期，进行服务强制或者容错降级，执行本地降级逻辑，保证系统平稳运行
~			   | 服务超时控制   | 动态调整超时时间，在业务高峰期保障业务调用成功率
服务监控       | 性能统计       | 统计项包括服务调用时延、成功率、调用次数等
~             | 统计报表       | 提供多维度、实时和历史数据报表，同比、环比等性能对比数据，供运维、运营等使用
~			   | 告警           | 指标异常，根据告警策略发送告警，包括但不限于短信，E-mail、记录日志等
服务生命周期管理 | 上线审批     | 服务提供者不能随意线上发布服务，需要通过正规的审批流程批准之后才能上线
~               | 下线通知     | 服务提供者在下线某个服务之前一段时间，需要根据SLA策略，通知消费者
~                | 服务灰度发布 | 灰度环境划分原则、接口前向兼容性策略，以及消费者如何路由，有需要灰度发布引擎负责管理
故障快速定界定位 | 分布式日志采集 | 支持在				 







